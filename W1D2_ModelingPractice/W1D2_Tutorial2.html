
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tutorial 2: Model implementation and evaluation &#8212; Neuromatch Computational Neuroscience</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="W1D3 - Model Fitting" href="../W1D3_ModelFitting/README.html" />
    <link rel="prev" title="Tutorial 1: Framing the question" href="W1D2_Tutorial1.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <h1 class="site-logo" id="site-title">Neuromatch Computational Neuroscience</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   NMA 2021
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Week 1
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../W1D1_ModelTypes/README.html">
   Model Types (W1D1)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D1_ModelTypes/W1D1_Tutorial1.html">
     Tutorial 1: “What” models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D1_ModelTypes/W1D1_Tutorial2.html">
     Tutorial 2: “How” models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D1_ModelTypes/W1D1_Tutorial3.html">
     Tutorial 3: “Why” models
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   Modeling Practice (W1D2)
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="W1D2_Tutorial1.html">
     Tutorial 1: Framing the question
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Tutorial 2: Model implementation and evaluation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../W1D3_ModelFitting/README.html">
   Model Fitting (W1D3)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D3_ModelFitting/W1D3_Tutorial1.html">
     Tutorial 1: Linear regression with MSE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D3_ModelFitting/W1D3_Tutorial2.html">
     Tutorial 2: Linear regression with MLE
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D3_ModelFitting/W1D3_Tutorial3.html">
     Tutorial 3: Confidence intervals and bootstrapping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D3_ModelFitting/W1D3_Tutorial4.html">
     Tutorial 4: Multiple linear regression and polynomial regression
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D3_ModelFitting/W1D3_Tutorial5.html">
     Tutorial 5: Model Selection: Bias-variance trade-off
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D3_ModelFitting/W1D3_Tutorial6.html">
     Tutorial 6: Model Selection: Cross-validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../W1D4_MachineLearning/README.html">
   Machine Learning (W1D4)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D4_MachineLearning/W1D4_Tutorial1.html">
     Tutorial 1: GLMs for Encoding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D4_MachineLearning/W1D4_Tutorial2.html">
     Tutorial 2: Classifiers and regularizers
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../W1D5_DimensionalityReduction/README.html">
   Dimensionality Reduction (W1D5)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D5_DimensionalityReduction/W1D5_Tutorial1.html">
     Tutorial 1: Geometric view of data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D5_DimensionalityReduction/W1D5_Tutorial2.html">
     Tutorial 2: Principal Component Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D5_DimensionalityReduction/W1D5_Tutorial3.html">
     Tutorial 3: Dimensionality Reduction &amp; Reconstruction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../W1D5_DimensionalityReduction/W1D5_Tutorial4.html">
     Tutorial 4:  Nonlinear Dimensionality Reduction
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/W1D2_ModelingPractice/W1D2_Tutorial2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/NeuromatchAcademy/course_content/blob/master/book/W1D2_ModelingPractice/W1D2_Tutorial2.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Tutorial 2: Model implementation and evaluation
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tutorial-objectives">
   Tutorial objectives
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-6-model-planning">
   Section 6: Model planning
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#td-6-1-formulate-purpose-of-the-self-motion-function">
     TD 6.1: Formulate purpose of the self motion function
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-7-model-implementation">
   Section 7: Model implementation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#td-7-1-write-code-to-estimate-self-motion">
     TD 7.1: Write code to estimate self motion
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-1-finish-self-motion-function">
       Exercise 1: finish self motion function
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interactive-demo-unit-testing">
       Interactive Demo: Unit testing
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-8-model-completion">
   Section 8: Model completion
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#td-8-1-see-if-the-model-produces-illusions">
     TD 8.1: See if the model produces illusions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-9-model-evaluation">
   Section 9: Model evaluation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#td-9-1-varying-the-threshold-parameter-to-improve-the-model">
     TD 9.1 Varying the threshold parameter to improve the model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interactive-demo-optimizing-the-model">
       Interactive Demo: optimizing the model
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#td-9-2-credit-assigmnent-of-self-motion">
     TD 9.2: Credit assigmnent of self motion
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#exercise-2-function-for-credit-assigment-of-self-motion">
       Exercise 2: function for credit assigment of self motion
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interactive-demo-evaluating-the-model">
       Interactive Demo: evaluating the model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#section-10-model-publication">
   Section 10: Model publication!
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#td-10-1-write-a-summary-of-the-project">
     TD 10.1: Write a summary of the project
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#guidance-for-the-future">
       Guidance for the future
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#suggestion">
       Suggestion
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#post-script">
     Post-script
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading">
   Reading
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><a href="https://colab.research.google.com/github/NeuromatchAcademy/course-content/blob/master/tutorials/W1D2_ModelingPractice/W1D2_Tutorial2.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="section" id="tutorial-2-model-implementation-and-evaluation">
<h1>Tutorial 2: Model implementation and evaluation<a class="headerlink" href="#tutorial-2-model-implementation-and-evaluation" title="Permalink to this headline">¶</a></h1>
<p><strong>Week 1, Day 2: Modeling Practice</strong></p>
<p><strong>By Neuromatch Academy</strong>
<strong>Content creators:</strong> Marius ‘t Hart, Paul Schrater, Gunnar Blohm</p>
<p><strong>Content reviewers:</strong> Norma Kuhn, Saeed Salehi, Madineh Sarvestani, Spiros Chavlis, Michael Waskom</p>
</div>
<hr class="docutils" />
<div class="section" id="tutorial-objectives">
<h1>Tutorial objectives<a class="headerlink" href="#tutorial-objectives" title="Permalink to this headline">¶</a></h1>
<p>We are investigating a simple phenomena, working through the 10 steps of modeling (<a class="reference external" href="https://doi.org/10.1523/ENEURO.0352-19.2019">Blohm et al., 2019</a>) in two notebooks:</p>
<p><strong>Framing the question</strong></p>
<ol class="simple">
<li><p>finding a phenomenon and a question to ask about it</p></li>
<li><p>understanding the state of the art</p></li>
<li><p>determining the basic ingredients</p></li>
<li><p>formulating specific, mathematically defined hypotheses</p></li>
</ol>
<p><strong>Implementing the model</strong></p>
<ol class="simple">
<li><p>selecting the toolkit</p></li>
<li><p>planning the model</p></li>
<li><p>implementing the model</p></li>
</ol>
<p><strong>Model testing</strong></p>
<ol class="simple">
<li><p>completing the model</p></li>
<li><p>testing and evaluating the model</p></li>
</ol>
<p><strong>Publishing</strong></p>
<ol class="simple">
<li><p>publishing models</p></li>
</ol>
<p>We did steps 1-5 in Tutorial 1 and will cover steps 6-10 in Tutorial 2 (this notebook).</p>
</div>
<div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Figure settings</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>

<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/NeuromatchAcademy/course-content/master/nma.mplstyle&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Helper functions</span>


<span class="k">def</span> <span class="nf">my_moving_window</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">FUN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates a moving estimate for a signal</span>

<span class="sd">    Args:</span>
<span class="sd">        x (numpy.ndarray): a vector array of size N</span>
<span class="sd">        window (int): size of the window, must be a positive integer</span>
<span class="sd">        FUN (function): the function to apply to the samples in the window</span>

<span class="sd">    Returns:</span>
<span class="sd">        (numpy.ndarray): a vector array of size N, containing the moving</span>
<span class="sd">        average of x, calculated with a window of size window</span>

<span class="sd">    There are smarter and faster solutions (e.g. using convolution) but this</span>
<span class="sd">    function shows what the output really means. This function skips NaNs, and</span>
<span class="sd">    should not be susceptible to edge effects: it will simply use</span>
<span class="sd">    all the  available samples, which means that close to the edges of the</span>
<span class="sd">    signal or close to NaNs, the output will just be based on fewer samples. By</span>
<span class="sd">    default, this function will apply a mean to the samples in the window, but</span>
<span class="sd">    this can be changed to be a max/min/median or other function that returns a</span>
<span class="sd">    single numeric value based on a sequence of values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># if data is a matrix, apply filter to each row:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rown</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">output</span><span class="p">[</span><span class="n">rown</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">my_moving_window</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">rown</span><span class="p">,</span> <span class="p">:],</span>
                                               <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">FUN</span><span class="o">=</span><span class="n">FUN</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="c1"># make output array of the same size as x:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

    <span class="c1"># loop through the signal in x</span>
    <span class="k">for</span> <span class="n">samp_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># loop through the window:</span>
        <span class="k">for</span> <span class="n">wind_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">window</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>

            <span class="k">if</span> <span class="p">((</span><span class="n">samp_i</span> <span class="o">+</span> <span class="n">wind_i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">samp_i</span> <span class="o">+</span> <span class="n">wind_i</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># out of range</span>
                <span class="k">continue</span>

            <span class="c1"># sample is in range and not nan, use it:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">samp_i</span> <span class="o">+</span> <span class="n">wind_i</span><span class="p">])):</span>
                <span class="n">values</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">samp_i</span> <span class="o">+</span> <span class="n">wind_i</span><span class="p">]]</span>

        <span class="c1"># calculate the mean in the window for this point in the output:</span>
        <span class="n">output</span><span class="p">[</span><span class="n">samp_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">FUN</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">output</span>


<span class="k">def</span> <span class="nf">my_plot_percepts</span><span class="p">(</span><span class="n">datasets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plotconditions</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># try to plot the datasets</span>
        <span class="c1"># they should be named...</span>
        <span class="c1"># &#39;expectations&#39;, &#39;judgments&#39;, &#39;predictions&#39;</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>  <span class="c1"># set aspect ratio = 1? not really</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;perceived self motion [m/s]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;perceived world motion [m/s]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;perceived velocities&#39;</span><span class="p">)</span>

        <span class="c1"># loop through the entries in datasets</span>
        <span class="c1"># plot them in the appropriate way</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">datasets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;expectations&#39;</span><span class="p">:</span>

                <span class="n">expect</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">expect</span><span class="p">[</span><span class="s1">&#39;world&#39;</span><span class="p">],</span> <span class="n">expect</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;my expectations&#39;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;judgments&#39;</span><span class="p">:</span>

                <span class="n">judgments</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span>
                    <span class="n">c_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">condition</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cond_self_motion</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[</span><span class="n">c_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">cond_world_motion</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[</span><span class="n">c_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">cond_world_motion</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">cond_self_motion</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">c_label</span> <span class="o">=</span> <span class="s1">&#39;world-motion condition judgments&#39;</span>
                    <span class="k">elif</span> <span class="n">cond_world_motion</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cond_self_motion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">c_label</span> <span class="o">=</span> <span class="s1">&#39;self-motion condition judgments&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">c_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;condition [</span><span class="si">{</span><span class="n">condition</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">] judgments&quot;</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">judgments</span><span class="p">[</span><span class="n">c_idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">judgments</span><span class="p">[</span><span class="n">c_idx</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">c_label</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;predictions&#39;</span><span class="p">:</span>

                <span class="n">predictions</span> <span class="o">=</span> <span class="n">datasets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">predictions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span>
                    <span class="n">c_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">predictions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">condition</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cond_self_motion</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="n">c_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">cond_world_motion</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="n">c_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">cond_world_motion</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">cond_self_motion</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">c_label</span> <span class="o">=</span> <span class="s1">&#39;predicted world-motion condition&#39;</span>
                    <span class="k">elif</span> <span class="n">cond_world_motion</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">cond_self_motion</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">c_label</span> <span class="o">=</span> <span class="s1">&#39;predicted self-motion condition&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">c_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;condition [</span><span class="si">{</span><span class="n">condition</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">] prediction&quot;</span>

                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="n">c_idx</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">predictions</span><span class="p">[</span><span class="n">c_idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">c_label</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;datasets keys should be &#39;hypothesis&#39;, </span><span class="se">\</span>
<span class="s2">                &#39;judgments&#39; and &#39;predictions&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotconditions</span><span class="p">:</span>
            <span class="c1"># this code is simplified but only works for the dataset we have:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;world-motion stimulus&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;self-motion stimulus&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;xkcd:white&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">datasets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;datasets argument should be a dict&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span>


<span class="k">def</span> <span class="nf">my_plot_stimuli</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;acceleration [$m/s^2$]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;velocity [$m/s$]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;[motion]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;xkcd:white&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">my_plot_motion_signals</span><span class="p">():</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">10</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="p">),</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span>
                                   <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Sensory ground truth&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;world-motion condition&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;visual [$m/s$]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;vestibular [$m/s^2$]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;motion&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;xkcd:white&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;self-motion condition&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;visual [$m/s$]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;vestibular [$m/s^2$]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;motion&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;xkcd:white&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">my_plot_sensorysignals</span><span class="p">(</span><span class="n">judgments</span><span class="p">,</span> <span class="n">opticflow</span><span class="p">,</span> <span class="n">vestibular</span><span class="p">,</span> <span class="n">returnaxes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">addaverages</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">integrateVestibular</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">addGroundTruth</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">addGroundTruth</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="p">),</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">a</span>

    <span class="n">wm_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">sm_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">opticflow</span> <span class="o">=</span> <span class="n">opticflow</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">wm_opticflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">opticflow</span><span class="p">[:,</span> <span class="n">wm_idx</span><span class="p">])</span>
    <span class="n">sm_opticflow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">opticflow</span><span class="p">[:,</span> <span class="n">sm_idx</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">integrateVestibular</span><span class="p">:</span>
        <span class="n">vestibular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">vestibular</span> <span class="o">*</span> <span class="o">.</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">addGroundTruth</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">vestibular</span> <span class="o">=</span> <span class="n">vestibular</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">wm_vestibular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">vestibular</span><span class="p">[:,</span> <span class="n">wm_idx</span><span class="p">])</span>
    <span class="n">sm_vestibular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">vestibular</span><span class="p">[:,</span> <span class="n">sm_idx</span><span class="p">])</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">my_axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span>
                                <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Sensory signals&#39;</span><span class="p">)</span>

    <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">wm_opticflow</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:light red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addGroundTruth</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addaverages</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">wm_opticflow</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;optic-flow in world-motion condition&#39;</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;velocity signal [$m/s$]&#39;</span><span class="p">)</span>

    <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">sm_opticflow</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:azure&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addGroundTruth</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:blue&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addaverages</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sm_opticflow</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;optic-flow in self-motion condition&#39;</span><span class="p">)</span>

    <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">wm_vestibular</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:light red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addaverages</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">wm_vestibular</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;vestibular signal in world-motion condition&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addGroundTruth</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:red&#39;</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">integrateVestibular</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;velocity signal [$m/s$]&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;acceleration signal [$m/s^2$]&#39;</span><span class="p">)</span>

    <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">sm_vestibular</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:azure&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addGroundTruth</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:blue&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">addaverages</span><span class="p">:</span>
        <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">sm_vestibular</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;vestibular signal in self-motion condition&#39;</span><span class="p">)</span>
    <span class="n">my_axes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [s]&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">returnaxes</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">my_axes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">my_threshold_solution</span><span class="p">(</span><span class="n">selfmotion_vel_est</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="n">is_move</span> <span class="o">=</span> <span class="p">(</span><span class="n">selfmotion_vel_est</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">is_move</span>


<span class="k">def</span> <span class="nf">my_moving_threshold</span><span class="p">(</span><span class="n">selfmotion_vel_est</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>

    <span class="n">pselfmove_nomove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">pselfmove_move</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">prop_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">pselfmove_nomove</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="n">pselfmove_move</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="n">prop_correct</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>

    <span class="k">for</span> <span class="n">thr_i</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">thresholds</span><span class="p">):</span>

        <span class="c1"># run my_threshold that the students will write:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">is_move</span> <span class="o">=</span> <span class="n">my_threshold</span><span class="p">(</span><span class="n">selfmotion_vel_est</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">is_move</span> <span class="o">=</span> <span class="n">my_threshold_solution</span><span class="p">(</span><span class="n">selfmotion_vel_est</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>

        <span class="c1"># store results:</span>
        <span class="n">pselfmove_nomove</span><span class="p">[</span><span class="n">thr_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">is_move</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">])</span>
        <span class="n">pselfmove_move</span><span class="p">[</span><span class="n">thr_i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">is_move</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">200</span><span class="p">])</span>

        <span class="c1"># calculate the proportion classified correctly:</span>
        <span class="c1"># (1-pselfmove_nomove) + ()</span>
        <span class="c1"># Correct rejections:</span>
        <span class="n">p_CR</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pselfmove_nomove</span><span class="p">[</span><span class="n">thr_i</span><span class="p">])</span>
        <span class="c1"># correct detections:</span>
        <span class="n">p_D</span> <span class="o">=</span> <span class="n">pselfmove_move</span><span class="p">[</span><span class="n">thr_i</span><span class="p">]</span>

        <span class="c1"># this is corrected for proportion of trials in each condition:</span>
        <span class="n">prop_correct</span><span class="p">[</span><span class="n">thr_i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_CR</span> <span class="o">+</span> <span class="n">p_D</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">pselfmove_nomove</span><span class="p">,</span> <span class="n">pselfmove_move</span><span class="p">,</span> <span class="n">prop_correct</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">my_plot_thresholds</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">world_prop</span><span class="p">,</span> <span class="n">self_prop</span><span class="p">,</span> <span class="n">prop_correct</span><span class="p">):</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;threshold effects&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">thresholds</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">thresholds</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">thresholds</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">world_prop</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;world motion condition&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">self_prop</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;self motion condition&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">prop_correct</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:purple&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;correct classification&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;threshold&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;proportion correct or classified as self motion&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;xkcd:white&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">my_plot_predictions_data</span><span class="p">(</span><span class="n">judgments</span><span class="p">,</span> <span class="n">predictions</span><span class="p">):</span>

    <span class="c1"># conditions = np.concatenate((np.abs(judgments[:, 1]),</span>
    <span class="c1">#                              np.abs(judgments[:, 2])))</span>
    <span class="c1"># veljudgmnt = np.concatenate((judgments[:, 3], judgments[:, 4]))</span>
    <span class="c1"># velpredict = np.concatenate((predictions[:, 3], predictions[:, 4]))</span>

    <span class="c1"># self:</span>
    <span class="c1"># conditions_self = np.abs(judgments[:, 1])</span>
    <span class="n">veljudgmnt_self</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">velpredict_self</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="c1"># world:</span>
    <span class="c1"># conditions_world = np.abs(judgments[:, 2])</span>
    <span class="n">veljudgmnt_world</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">velpredict_world</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>

    <span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>
                                   <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">veljudgmnt_self</span><span class="p">,</span> <span class="n">velpredict_self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;self-motion judgments&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;predicted&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">veljudgmnt_world</span><span class="p">,</span> <span class="n">velpredict_world</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;xkcd:black&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;world-motion judgments&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;predicted&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Data retrieval</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">fname</span><span class="o">=</span><span class="s2">&quot;W1D2_data.npz&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
  <span class="o">!</span>wget https://osf.io/c5xyf/download -O <span class="nv">$fname</span>

<span class="n">filez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">judgments</span> <span class="o">=</span> <span class="n">filez</span><span class="p">[</span><span class="s1">&#39;judgments&#39;</span><span class="p">]</span>
<span class="n">opticflow</span> <span class="o">=</span> <span class="n">filez</span><span class="p">[</span><span class="s1">&#39;opticflow&#39;</span><span class="p">]</span>
<span class="n">vestibular</span> <span class="o">=</span> <span class="n">filez</span><span class="p">[</span><span class="s1">&#39;vestibular&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="section-6-model-planning">
<h1>Section 6: Model planning<a class="headerlink" href="#section-6-model-planning" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Video 6: Planning</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">YouTubeVideo</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;dRTOFFigxa0&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">854</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video available at https://youtube.com/watch?v=</span><span class="si">{</span><span class="n">video</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">video</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Goal:</strong> Identify the key components of the model and how they work together.</p>
<p>Our goal all along has been to model our perceptual estimates of sensory data.
Now that we have some idea of what we want to do, we need to line up the components of the model: what are the input and output? Which computations are done and in what order?</p>
<p>Our model will have:</p>
<ul class="simple">
<li><p><strong>inputs</strong>: the values the system has available - this can be broken down in <em>data:</em> the sensory signals, <em>parameters:</em> the threshold and the window sizes for filtering</p></li>
<li><p><strong>outputs</strong>: these are the predictions our model will make - for this tutorial these are the perceptual judgments on each trial in m/s, just like the judgments participants made.</p></li>
<li><p><strong>model functions</strong>: A set of functions that perform the hypothesized computations.</p></li>
</ul>
<p>We will define a set of functions that take our data and some parameters as input, can run our model, and output a prediction for the judgment data.</p>
<p><strong>Recap of what we’ve accomplished so far:</strong></p>
<p>To model perceptual estimates from our sensory data, we need to</p>
<ol class="simple">
<li><p><em>integrate:</em> to ensure sensory information are in appropriate units</p></li>
<li><p><em>filter:</em> to reduce noise and set timescale</p></li>
<li><p><em>threshold:</em> to model detection</p></li>
</ol>
<p>This will be done with these operations:</p>
<ol class="simple">
<li><p><em>integrate:</em> <code class="docutils literal notranslate"><span class="pre">np.cumsum()</span></code></p></li>
<li><p><em>filter:</em> <code class="docutils literal notranslate"><span class="pre">my_moving_window()</span></code></p></li>
<li><p><em>threshold:</em> <code class="docutils literal notranslate"><span class="pre">if</span></code> with a comparison (<code class="docutils literal notranslate"><span class="pre">&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>) and <code class="docutils literal notranslate"><span class="pre">else</span></code></p></li>
</ol>
<p><strong><em>Planning our model:</em></strong></p>
<p>We will now start putting all the pieces together. Normally you would sketch this yourself, but here is an overview of how the functions comprising the model are going to work:</p>
<p><img alt="model functions purpose" src="https://raw.githubusercontent.com/NeuromatchAcademy/course-content/master/tutorials/W1D2_ModelingPractice/static/NMA-W1D2-fig05.png" /></p>
<p>Below is the main function with a detailed explanation of what the function is supposed to do, exactly what input is expected, and what output will be generated.</p>
<p>The model is not complete, so it only returns nans (<strong>n</strong>ot-<strong>a</strong>-<strong>n</strong>umber) for now. However, this outlines how most model code works: it gets some measured data (the sensory signals) and a set of parameters as input, and as output returns a prediction on other measured data (the velocity judgments).</p>
<p>The goal of this function is to define the top level of a simulation model which:</p>
<ul class="simple">
<li><p>receives all input</p></li>
<li><p>loops through the cases</p></li>
<li><p>calls functions that computes predicted values for each case</p></li>
<li><p>outputs the predictions</p></li>
</ul>
<p><strong>Main model function</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_train_illusion_model</span><span class="p">(</span><span class="n">sensorydata</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Generate output predictions of perceived self-motion and perceived</span>
<span class="sd">  world-motion velocity based on input visual and vestibular signals.</span>

<span class="sd">  Args:</span>

<span class="sd">    sensorydata: (dict) dictionary with two named entries:</span>
<span class="sd">        opticflow: (numpy.ndarray of float) NxM array with N trials on rows</span>
<span class="sd">                   and M visual signal samples in columns</span>

<span class="sd">        vestibular: (numpy.ndarray of float) NxM array with N trials on rows</span>
<span class="sd">                    and M vestibular signal samples in columns</span>

<span class="sd">    params: (dict) dictionary with named entries:</span>
<span class="sd">        threshold: (float) vestibular threshold for credit assignment</span>

<span class="sd">        filterwindows: (list of int) determines the strength of filtering for</span>
<span class="sd">                      the vestibular and visual signals, respectively</span>

<span class="sd">        integrate (bool): whether to integrate the vestibular signals, will</span>
<span class="sd">                          be set to True if absent</span>

<span class="sd">        FUN (function): function used in the filter, will be set to</span>
<span class="sd">                        np.mean if absent</span>

<span class="sd">        samplingrate (float): the number of samples per second in the</span>
<span class="sd">                              sensory data, will be set to 10 if absent</span>

<span class="sd">  Returns:</span>

<span class="sd">    dict with two entries:</span>

<span class="sd">      selfmotion: (numpy.ndarray) vector array of length N, with predictions</span>
<span class="sd">                  of perceived self motion</span>

<span class="sd">      worldmotion: (numpy.ndarray) vector array of length N, with predictions</span>
<span class="sd">                   of perceived world motion</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># sanitize input a little</span>
  <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="s1">&#39;FUN&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;FUN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span>
  <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="s1">&#39;integrate&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;integrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
  <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="s1">&#39;samplingrate&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;samplingrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>

  <span class="c1"># number of trials:</span>
  <span class="n">ntrials</span> <span class="o">=</span> <span class="n">sensorydata</span><span class="p">[</span><span class="s1">&#39;opticflow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="c1"># set up variables to collect output</span>
  <span class="n">selfmotion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ntrials</span><span class="p">)</span>
  <span class="n">worldmotion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ntrials</span><span class="p">)</span>

  <span class="c1"># loop through trials?</span>
  <span class="k">for</span> <span class="n">trialN</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntrials</span><span class="p">):</span>

      <span class="c1"># these are our sensory variables (inputs)</span>
      <span class="n">vis</span> <span class="o">=</span> <span class="n">sensorydata</span><span class="p">[</span><span class="s1">&#39;opticflow&#39;</span><span class="p">][</span><span class="n">trialN</span><span class="p">,</span> <span class="p">:]</span>
      <span class="n">ves</span> <span class="o">=</span> <span class="n">sensorydata</span><span class="p">[</span><span class="s1">&#39;vestibular&#39;</span><span class="p">][</span><span class="n">trialN</span><span class="p">,</span> <span class="p">:]</span>

      <span class="c1"># generate output predicted perception:</span>
      <span class="n">selfmotion</span><span class="p">[</span><span class="n">trialN</span><span class="p">],</span>\
        <span class="n">worldmotion</span><span class="p">[</span><span class="n">trialN</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_perceived_motion</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="n">vis</span><span class="p">,</span> <span class="n">ves</span><span class="o">=</span><span class="n">ves</span><span class="p">,</span>
                                                  <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

  <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;selfmotion&#39;</span><span class="p">:</span> <span class="n">selfmotion</span><span class="p">,</span> <span class="s1">&#39;worldmotion&#39;</span><span class="p">:</span> <span class="n">worldmotion</span><span class="p">}</span>


<span class="c1"># here is a mock version of my_perceived motion.</span>
<span class="c1"># so you can test my_train_illusion_model()</span>
<span class="k">def</span> <span class="nf">my_perceived_motion</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>


<span class="c1"># let&#39;s look at the preditions we generated for two sample trials (0,100)</span>
<span class="c1"># we should get a 1x2 vector of self-motion prediction and another</span>
<span class="c1"># for world-motion</span>

<span class="n">sensorydata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;opticflow&#39;</span><span class="p">:</span> <span class="n">opticflow</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">:</span><span class="mi">0</span><span class="p">],</span>
             <span class="s1">&#39;vestibular&#39;</span><span class="p">:</span> <span class="n">vestibular</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">:</span><span class="mi">0</span><span class="p">]}</span>
<span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span> <span class="s1">&#39;filterwindows&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">]}</span>
<span class="n">my_train_illusion_model</span><span class="p">(</span><span class="n">sensorydata</span><span class="o">=</span><span class="n">sensorydata</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We’ve also completed the <code class="docutils literal notranslate"><span class="pre">my_perceived_motion()</span></code> function for you below. Follow this example to complete the template for <code class="docutils literal notranslate"><span class="pre">my_selfmotion()</span></code> and <code class="docutils literal notranslate"><span class="pre">my_worldmotion()</span></code>. Write out the inputs and outputs, and the steps required to calculate the outputs from the inputs.</p>
<p><strong>Perceived motion function</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full perceived motion function</span>


<span class="k">def</span> <span class="nf">my_perceived_motion</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">ves</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Takes sensory data and parameters and returns predicted percepts</span>

<span class="sd">  Args:</span>
<span class="sd">      vis (numpy.ndarray) : 1xM array of optic flow velocity data</span>
<span class="sd">      ves (numpy.ndarray) : 1xM array of vestibular acceleration data</span>
<span class="sd">      params              : (dict) dictionary with named entries:</span>
<span class="sd">                            see my_train_illusion_model() for details</span>

<span class="sd">  Returns:</span>
<span class="sd">      [list of floats]    : prediction for perceived self-motion based on</span>
<span class="sd">                            vestibular data, and prediction for perceived</span>
<span class="sd">                            world-motion based on perceived self-motion and</span>
<span class="sd">                            visual data</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># estimate self motion based on only the vestibular data</span>
  <span class="c1"># pass on the parameters</span>
  <span class="n">selfmotion</span> <span class="o">=</span> <span class="n">my_selfmotion</span><span class="p">(</span><span class="n">ves</span><span class="o">=</span><span class="n">ves</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

  <span class="c1"># estimate the world motion, based on the selfmotion and visual data</span>
  <span class="c1"># pass on the parameters as well</span>
  <span class="n">worldmotion</span> <span class="o">=</span> <span class="n">my_worldmotion</span><span class="p">(</span><span class="n">vis</span><span class="o">=</span><span class="n">vis</span><span class="p">,</span> <span class="n">selfmotion</span><span class="o">=</span><span class="n">selfmotion</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

  <span class="k">return</span> <span class="p">[</span><span class="n">selfmotion</span><span class="p">,</span> <span class="n">worldmotion</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="td-6-1-formulate-purpose-of-the-self-motion-function">
<h2>TD 6.1: Formulate purpose of the self motion function<a class="headerlink" href="#td-6-1-formulate-purpose-of-the-self-motion-function" title="Permalink to this headline">¶</a></h2>
<p>Now we plan out the purpose of one of the remaining functions. <strong>Only name input arguments, write help text and comments, <em>no code</em>.</strong> The goal of this exercise is to make writing the code (in Micro-tutorial 7) much easier. Based on our work before the break, you should now be able to answer these questions for each function:</p>
<ul class="simple">
<li><p>what (sensory) data is necessary?</p></li>
<li><p>what parameters does the function need, if any?</p></li>
<li><p>which operations will be performed on the input?</p></li>
<li><p>what is the output?</p></li>
</ul>
<p>The number of arguments is correct.</p>
<p><strong>Template calculate self motion</strong></p>
<p>Name the <em>input arguments</em>, complete the <em>help text</em>, and add <em>comments</em> in the function below to describe the inputs, the outputs, and operations using elements from the recap at the top of this notebook (or from micro-tutorials 3 and 4 in part 1), in order to plan out the function. Do not write any code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_selfmotion</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Short description of the function</span>

<span class="sd">    Args:</span>
<span class="sd">        argument 1: explain the format and content of the first argument</span>
<span class="sd">        argument 2: explain the format and content of the second argument</span>

<span class="sd">    Returns:</span>
<span class="sd">        what output does the function generate?</span>

<span class="sd">    Any further description?</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">##################################################</span>
    <span class="c1"># what operations do we perform on the input?</span>
    <span class="c1"># use the elements from micro-tutorials 3, 4, and 5</span>
    <span class="c1"># 1.</span>
    <span class="c1"># 2.</span>
    <span class="c1"># 3.</span>
    <span class="c1"># 4.</span>

    <span class="c1"># what output should this function produce?</span>
    <span class="c1">##################################################</span>

    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove explanation</span>

<span class="k">def</span> <span class="nf">my_selfmotion</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates self motion for one vestibular signal</span>

<span class="sd">    Args:</span>
<span class="sd">        ves (numpy.ndarray): 1xM array with a vestibular signal</span>
<span class="sd">        params (dict): dictionary with named entries:</span>
<span class="sd">            see my_train_illusion_model() for details</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): an estimate of self motion in m/s</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">##################################################</span>
    <span class="c1"># 1. integrate vestibular signal</span>
    <span class="c1"># 2. running window function</span>
    <span class="c1"># 3. take final value</span>
    <span class="c1"># 4. compare to threshold</span>

    <span class="c1"># if higher than threshold: return value</span>
    <span class="c1"># if lower than threshold: return 0</span>
    <span class="c1">##################################################</span>

    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Template calculate world motion</strong></p>
<p>We have drafted the help text and written comments in the function below that describe the inputs, the outputs, and operations we use to estimate world motion, based on the recap above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># World motion function</span>


<span class="k">def</span> <span class="nf">my_worldmotion</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">selfmotion</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates world motion based on the visual signal, the estimate of</span>

<span class="sd">    Args:</span>
<span class="sd">        vis (numpy.ndarray): 1xM array with the optic flow signal</span>
<span class="sd">        selfmotion (float): estimate of self motion</span>
<span class="sd">        params (dict): dictionary with named entries:</span>
<span class="sd">            see my_train_illusion_model() for details</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): an estimate of world motion in m/s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##################################################</span>
    <span class="c1"># 1. running window function</span>
    <span class="c1"># 2. take final value</span>
    <span class="c1"># 3. subtract selfmotion from value</span>

    <span class="c1"># return final value</span>
    <span class="c1">##################################################</span>
    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="section-7-model-implementation">
<h1>Section 7: Model implementation<a class="headerlink" href="#section-7-model-implementation" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Video 7: Implementation</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">YouTubeVideo</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;DMSIt7t-LO8&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">854</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video available at https://youtube.com/watch?v=</span><span class="si">{</span><span class="n">video</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">video</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Goal:</strong> We write the components of the model in actual code.</p>
<p>For the operations we picked, there function ready to use:</p>
<ul class="simple">
<li><p>integration: <code class="docutils literal notranslate"><span class="pre">np.cumsum(data,</span> <span class="pre">axis=1)</span></code> (axis=1: per trial and over samples)</p></li>
<li><p>filtering: <code class="docutils literal notranslate"><span class="pre">my_moving_window(data,</span> <span class="pre">window)</span></code> (window: int, default 3)</p></li>
<li><p>take last <code class="docutils literal notranslate"><span class="pre">selfmotion</span></code> value as our estimate</p></li>
<li><p>threshold: if (value &gt; thr): &lt;operation 1&gt; else: &lt;operation 2&gt;</p></li>
</ul>
<div class="section" id="td-7-1-write-code-to-estimate-self-motion">
<h2>TD 7.1: Write code to estimate self motion<a class="headerlink" href="#td-7-1-write-code-to-estimate-self-motion" title="Permalink to this headline">¶</a></h2>
<p>Use the operations to finish writing the function that will calculate an estimate of self motion. Fill in the descriptive list of items with actual operations. Use the function for estimating world-motion below, which we’ve filled for you!</p>
<div class="section" id="exercise-1-finish-self-motion-function">
<h3>Exercise 1: finish self motion function<a class="headerlink" href="#exercise-1-finish-self-motion-function" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_selfmotion</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates self motion for one vestibular signal</span>

<span class="sd">    Args:</span>
<span class="sd">        ves (numpy.ndarray): 1xM array with a vestibular signal</span>
<span class="sd">        params (dict)      : dictionary with named entries:</span>
<span class="sd">                             see my_train_illusion_model() for details</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float)            : an estimate of self motion in m/s</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">##################################################</span>
    <span class="c1">## TODO for students: fill in ... in code below</span>
    <span class="c1"># Fill out function and remove</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Student exercise: estimate my_selfmotion&quot;</span><span class="p">)</span>
    <span class="c1">##################################################</span>

    <span class="c1"># 1. integrate vestibular signal:</span>
    <span class="n">ves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ves</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;samplingrate&#39;</span><span class="p">]))</span>

    <span class="c1"># 2. running window function to accumulate evidence:</span>
    <span class="n">selfmotion</span> <span class="o">=</span> <span class="o">...</span>

    <span class="c1"># 3. take final value of self-motion vector as our estimate</span>
    <span class="n">selfmotion</span> <span class="o">=</span> <span class="o">...</span>

    <span class="c1"># 4. compare to threshold. Hint the threshodl is stored in</span>
    <span class="c1"># params[&#39;threshold&#39;]</span>
    <span class="c1"># if selfmotion is higher than threshold: return value</span>
    <span class="c1"># if it&#39;s lower than threshold: return 0</span>

    <span class="k">if</span> <span class="o">...</span><span class="p">:</span>
      <span class="n">selfmotion</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">return</span> <span class="n">selfmotion</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove solution</span>

<span class="k">def</span> <span class="nf">my_selfmotion</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates self motion for one vestibular signal</span>

<span class="sd">    Args:</span>
<span class="sd">        ves (numpy.ndarray): 1xM array with a vestibular signal</span>
<span class="sd">        params (dict)      : dictionary with named entries:</span>
<span class="sd">                             see my_train_illusion_model() for details</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float)            : an estimate of self motion in m/s</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 1. integrate vestibular signal:</span>
    <span class="n">ves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ves</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;samplingrate&#39;</span><span class="p">]))</span>

    <span class="c1"># 2. running window function to accumulate evidence:</span>
    <span class="n">selfmotion</span> <span class="o">=</span> <span class="n">my_moving_window</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;filterwindows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># 3. take final value of self-motion vector as our estimate</span>
    <span class="n">selfmotion</span> <span class="o">=</span> <span class="n">selfmotion</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># 4. compare to threshold. Hint the threshodl is stored in</span>
    <span class="c1"># params[&#39;threshold&#39;]</span>
    <span class="c1"># if selfmotion is higher than threshold: return value</span>
    <span class="c1"># if it&#39;s lower than threshold: return 0</span>

    <span class="k">if</span> <span class="n">selfmotion</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]:</span>
        <span class="n">selfmotion</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">selfmotion</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interactive-demo-unit-testing">
<h3>Interactive Demo: Unit testing<a class="headerlink" href="#interactive-demo-unit-testing" title="Permalink to this headline">¶</a></h3>
<p>Testing if the functions you wrote do what they are supposed to do is important, and known as ‘unit testing’. Here we will simplify this for the <code class="docutils literal notranslate"><span class="pre">my_selfmotion()</span></code> function, by allowing varying the threshold and window size with a slider, and seeing what the distribution of self-motion estimates looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>

<span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>

<span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">windowsize</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;samplingrate&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;FUN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">}</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;filterwindows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">windowsize</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="n">selfmotion_estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

    <span class="c1"># get the estimates for each trial:</span>
    <span class="k">for</span> <span class="n">trial_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
        <span class="n">ves</span> <span class="o">=</span> <span class="n">vestibular</span><span class="p">[</span><span class="n">trial_number</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">selfmotion_estimates</span><span class="p">[</span><span class="n">trial_number</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_selfmotion</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">selfmotion_estimates</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;self-motion estimate&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">_</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">refresh</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">),</span> <span class="n">windowsize</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Estimate world motion</strong></p>
<p>We have completed the <code class="docutils literal notranslate"><span class="pre">my_worldmotion()</span></code> function for you below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># World motion function</span>
<span class="k">def</span> <span class="nf">my_worldmotion</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">selfmotion</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Short description of the function</span>

<span class="sd">    Args:</span>
<span class="sd">        vis (numpy.ndarray): 1xM array with the optic flow signal</span>
<span class="sd">        selfmotion (float): estimate of self motion</span>
<span class="sd">        params (dict): dictionary with named entries:</span>
<span class="sd">            see my_train_illusion_model() for details</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): an estimate of world motion in m/s</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># running average to smooth/accumulate sensory evidence</span>
    <span class="n">visualmotion</span> <span class="o">=</span> <span class="n">my_moving_window</span><span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;filterwindows&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">FUN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

    <span class="c1"># take final value</span>
    <span class="n">visualmotion</span> <span class="o">=</span> <span class="n">visualmotion</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># subtract selfmotion from value</span>
    <span class="n">worldmotion</span> <span class="o">=</span> <span class="n">visualmotion</span> <span class="o">+</span> <span class="n">selfmotion</span>

    <span class="c1"># return final value</span>
    <span class="k">return</span> <span class="n">worldmotion</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="section-8-model-completion">
<h1>Section 8: Model completion<a class="headerlink" href="#section-8-model-completion" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Video 8: Completion</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">YouTubeVideo</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;EM-G8YYdrDg&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">854</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video available at https://youtube.com/watch?v=</span><span class="si">{</span><span class="n">video</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">video</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Goal:</strong> Make sure the model can speak to the hypothesis. Eliminate all the parameters that do not speak to the hypothesis.</p>
<p>Now that we have a working model, we can keep improving it, but at some point we need to decide that it is finished. Once we have a model that displays the properties of a system we are interested in, it should be possible to say something about our hypothesis and question. Keeping the model simple makes it easier to understand the phenomenon and answer the research question. Here that means that our model should have illusory perception, and perhaps make similar judgments to those of the participants, but not much more.</p>
<p>To test this, we will run the model, store the output and plot the models’ perceived self motion over perceived world motion, like we did with the actual perceptual judgments (it even uses the same plotting function).</p>
<div class="section" id="td-8-1-see-if-the-model-produces-illusions">
<h2>TD 8.1: See if the model produces illusions<a class="headerlink" href="#td-8-1-see-if-the-model-produces-illusions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Run to plot model predictions of motion estimates</span>
<span class="c1"># prepare to run the model again:</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;opticflow&#39;</span><span class="p">:</span> <span class="n">opticflow</span><span class="p">,</span> <span class="s1">&#39;vestibular&#39;</span><span class="p">:</span> <span class="n">vestibular</span><span class="p">}</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;filterwindows&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;FUN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">}</span>
<span class="n">modelpredictions</span> <span class="o">=</span> <span class="n">my_train_illusion_model</span><span class="p">(</span><span class="n">sensorydata</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

<span class="c1"># process the data to allow plotting...</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">judgments</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;selfmotion&#39;</span><span class="p">]</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;worldmotion&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">my_plot_percepts</span><span class="p">(</span><span class="n">datasets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;predictions&#39;</span><span class="p">:</span> <span class="n">predictions</span><span class="p">},</span> <span class="n">plotconditions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Questions:</strong></p>
<ul class="simple">
<li><p>How does the distribution of data points compare to the plot in TD 1.2 or in TD 7.1?</p></li>
<li><p>Did you expect to see this?</p></li>
<li><p>Where do the model’s predicted judgments for each of the two conditions fall?</p></li>
<li><p>How does this compare to the behavioral data?</p></li>
</ul>
<p>However, the main observation should be that <strong>there are illusions</strong>: the blue and red data points are mixed in each of the two clusters of data points. This mean the model can help us understand the phenomenon.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="section-9-model-evaluation">
<h1>Section 9: Model evaluation<a class="headerlink" href="#section-9-model-evaluation" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Video 9: Evaluation</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">YouTubeVideo</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;bWLFyobm4Rk&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">854</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video available at https://youtube.com/watch?v=</span><span class="si">{</span><span class="n">video</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">video</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Goal:</strong> Once we have finished the model, we need a description of how good it is. The question and goals we set in micro-tutorial 1 and 4 help here. There are multiple ways to evaluate a model. Aside from the obvious fact that we want to get insight into the phenomenon that is not directly accessible without the model, we always want to quantify how well the model agrees with the data.</p>
<p><strong>Quantify model quality with <span class="math notranslate nohighlight">\(R^2\)</span></strong></p>
<p>Let’s look at how well our model matches the actual judgment data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Run to plot predictions over data</span>
<span class="n">my_plot_predictions_data</span><span class="p">(</span><span class="n">judgments</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>When model predictions are correct, the red points in the figure above should lie along the identity line (a dotted black line here). Points off the identity line represent model prediction errors. While in each plot we see two clusters of dots that are fairly close to the identity line, there are also two clusters that are not. For the trials that those points represent, the model has an illusion while the participants don’t or vice versa.</p>
<p>We will use a straightforward, quantitative measure of how good the model is: <span class="math notranslate nohighlight">\(R^2\)</span> (pronounced: “R-squared”), which can take values between 0 and 1, and expresses how much variance is explained by the relationship between two variables (here the model’s predictions and the actual judgments). It is also called <a class="reference external" href="https://en.wikipedia.org/wiki/Coefficient_of_determination">coefficient of determination</a>, and is calculated here as the square of the correlation coefficient (r or <span class="math notranslate nohighlight">\(\rho\)</span>). Just run the chunk below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @markdown Run to calculate R^2</span>
<span class="n">conditions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])))</span>
<span class="n">veljudgmnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]))</span>
<span class="n">velpredict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]))</span>

<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span>\
  <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">veljudgmnt</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;conditions -&gt; judgments R^2: </span><span class="si">{</span><span class="n">r_value</span> <span class="o">**</span> <span class="mi">2</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span>\
  <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">veljudgmnt</span><span class="p">,</span> <span class="n">velpredict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;predictions -&gt; judgments R^2: </span><span class="si">{</span><span class="n">r_value</span> <span class="o">**</span> <span class="mi">2</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>These <span class="math notranslate nohighlight">\(R^2\)</span>s express how well the experimental conditions explain the participants judgments and how well the models predicted judgments explain the participants judgments.</p>
<p>You will learn much more about model fitting, quantitative model evaluation and model comparison tomorrow!</p>
<p>Perhaps the <span class="math notranslate nohighlight">\(R^2\)</span> values don’t seem very impressive, but the judgments produced by the participants are explained by the model’s predictions better than by the actual conditions. In other words: in a certain percentage of cases the model tends to have the same illusions as the participants.</p>
<div class="section" id="td-9-1-varying-the-threshold-parameter-to-improve-the-model">
<h2>TD 9.1 Varying the threshold parameter to improve the model<a class="headerlink" href="#td-9-1-varying-the-threshold-parameter-to-improve-the-model" title="Permalink to this headline">¶</a></h2>
<p>In the code below, see if you can find a better value for the threshold parameter, to reduce errors in the models’ predictions.</p>
<p><strong>Testing thresholds</strong></p>
<div class="section" id="interactive-demo-optimizing-the-model">
<h3>Interactive Demo: optimizing the model<a class="headerlink" href="#interactive-demo-optimizing-the-model" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>

<span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;opticflow&#39;</span><span class="p">:</span> <span class="n">opticflow</span><span class="p">,</span> <span class="s1">&#39;vestibular&#39;</span><span class="p">:</span> <span class="n">vestibular</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">windowsize</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="c1"># set parameters according to sliders:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;samplingrate&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;FUN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">}</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;filterwindows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">windowsize</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="n">modelpredictions</span> <span class="o">=</span> <span class="n">my_train_illusion_model</span><span class="p">(</span><span class="n">sensorydata</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">judgments</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;selfmotion&#39;</span><span class="p">]</span>
    <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;worldmotion&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># plot the predictions:</span>
    <span class="n">my_plot_predictions_data</span><span class="p">(</span><span class="n">judgments</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

    <span class="c1"># calculate R2</span>
    <span class="n">veljudgmnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]))</span>
    <span class="n">velpredict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]))</span>
    <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span>\
      <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">veljudgmnt</span><span class="p">,</span> <span class="n">velpredict</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;predictions -&gt; judgments R^2: </span><span class="si">{</span><span class="n">r_value</span> <span class="o">**</span> <span class="mi">2</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">_</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">refresh</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">),</span> <span class="n">windowsize</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Varying the parameters this way, allows you to increase the models’ performance in predicting the actual data as measured by <span class="math notranslate nohighlight">\(R^2\)</span>. This is called model fitting, and will be done better in the coming weeks.</p>
</div>
</div>
<div class="section" id="td-9-2-credit-assigmnent-of-self-motion">
<h2>TD 9.2: Credit assigmnent of self motion<a class="headerlink" href="#td-9-2-credit-assigmnent-of-self-motion" title="Permalink to this headline">¶</a></h2>
<p>When we look at the figure in <strong>TD 8.1</strong>, we can see a cluster does seem very close to (1,0), just like in the actual data. The cluster of points at (1,0) are from the case where we conclude there is no self motion, and then set the self motion to 0. That value of 0 removes a lot of noise from the world-motion estimates, and all noise from the self-motion estimate. In the other case, where there is self motion, we still have a lot of noise (see also micro-tutorial 4).</p>
<p>Let’s change our <code class="docutils literal notranslate"><span class="pre">my_selfmotion()</span></code> function to return a self motion of 1 when the vestibular signal indicates we are above threshold, and 0 when we are below threshold. Edit the function here.</p>
<div class="section" id="exercise-2-function-for-credit-assigment-of-self-motion">
<h3>Exercise 2: function for credit assigment of self motion<a class="headerlink" href="#exercise-2-function-for-credit-assigment-of-self-motion" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_selfmotion</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates self motion for one vestibular signal</span>

<span class="sd">    Args:</span>
<span class="sd">        ves (numpy.ndarray): 1xM array with a vestibular signal</span>
<span class="sd">        params (dict): dictionary with named entries:</span>
<span class="sd">            see my_train_illusion_model() for details</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): an estimate of self motion in m/s</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># integrate signal:</span>
    <span class="n">ves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ves</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;samplingrate&#39;</span><span class="p">]))</span>

    <span class="c1"># use running window to accumulate evidence:</span>
    <span class="n">selfmotion</span> <span class="o">=</span> <span class="n">my_moving_window</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;filterwindows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">FUN</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;FUN&#39;</span><span class="p">])</span>

    <span class="c1"># take the final value as our estimate:</span>
    <span class="n">selfmotion</span> <span class="o">=</span> <span class="n">selfmotion</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">###########################################################################</span>
    <span class="c1"># Exercise: Complete credit assignment. Remove the next line to test your function</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Modify with credit assignment&quot;</span><span class="p">)</span>
    <span class="c1">###########################################################################</span>

    <span class="c1"># compare to threshold, set to 0 if lower</span>
    <span class="k">if</span> <span class="n">selfmotion</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]:</span>
        <span class="n">selfmotion</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selfmotion</span> <span class="o">=</span> <span class="o">...</span>

    <span class="k">return</span> <span class="n">selfmotion</span>

<span class="c1"># Use the updated function to run the model and plot the data</span>
<span class="c1"># Uncomment below to test your function</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;opticflow&#39;</span><span class="p">:</span> <span class="n">opticflow</span><span class="p">,</span> <span class="s1">&#39;vestibular&#39;</span><span class="p">:</span> <span class="n">vestibular</span><span class="p">}</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span> <span class="s1">&#39;filterwindows&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;FUN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">}</span>
<span class="c1"># modelpredictions = my_train_illusion_model(sensorydata=data, params=params)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">judgments</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;selfmotion&#39;</span><span class="p">]</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;worldmotion&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
<span class="c1"># my_plot_percepts(datasets={&#39;predictions&#39;: predictions}, plotconditions=False)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to_remove solution</span>

<span class="k">def</span> <span class="nf">my_selfmotion</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates self motion for one vestibular signal</span>

<span class="sd">    Args:</span>
<span class="sd">        ves (numpy.ndarray): 1xM array with a vestibular signal</span>
<span class="sd">        params (dict): dictionary with named entries:</span>
<span class="sd">            see my_train_illusion_model() for details</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): an estimate of self motion in m/s</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># integrate signal:</span>
    <span class="n">ves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">ves</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;samplingrate&#39;</span><span class="p">]))</span>

    <span class="c1"># use running window to accumulate evidence:</span>
    <span class="n">selfmotion</span> <span class="o">=</span> <span class="n">my_moving_window</span><span class="p">(</span><span class="n">ves</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;filterwindows&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">FUN</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;FUN&#39;</span><span class="p">])</span>

    <span class="c1"># take the final value as our estimate:</span>
    <span class="n">selfmotion</span> <span class="o">=</span> <span class="n">selfmotion</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># compare to threshold, set to 0 if lower</span>
    <span class="k">if</span> <span class="n">selfmotion</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]:</span>
        <span class="n">selfmotion</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selfmotion</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">selfmotion</span>

<span class="c1"># Use the updated function to run the model and plot the data</span>
<span class="c1"># Uncomment below to test your function</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;opticflow&#39;</span><span class="p">:</span> <span class="n">opticflow</span><span class="p">,</span> <span class="s1">&#39;vestibular&#39;</span><span class="p">:</span> <span class="n">vestibular</span><span class="p">}</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;threshold&#39;</span><span class="p">:</span> <span class="mf">0.33</span><span class="p">,</span> <span class="s1">&#39;filterwindows&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="s1">&#39;FUN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">}</span>
<span class="n">modelpredictions</span> <span class="o">=</span> <span class="n">my_train_illusion_model</span><span class="p">(</span><span class="n">sensorydata</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">judgments</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;selfmotion&#39;</span><span class="p">]</span>
<span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;worldmotion&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">xkcd</span><span class="p">():</span>
  <span class="n">my_plot_percepts</span><span class="p">(</span><span class="n">datasets</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;predictions&#39;</span><span class="p">:</span> <span class="n">predictions</span><span class="p">},</span> <span class="n">plotconditions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>That looks much better, and closer to the actual data. Let’s see if the <span class="math notranslate nohighlight">\(R^2\)</span> values have improved. Use the optimal values for the threshold and window size that you found previously.</p>
</div>
<div class="section" id="interactive-demo-evaluating-the-model">
<h3>Interactive Demo: evaluating the model<a class="headerlink" href="#interactive-demo-evaluating-the-model" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title</span>

<span class="c1">#@markdown Make sure you execute this cell to enable the widget!</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;opticflow&#39;</span><span class="p">:</span> <span class="n">opticflow</span><span class="p">,</span> <span class="s1">&#39;vestibular&#39;</span><span class="p">:</span> <span class="n">vestibular</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">windowsize</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>

    <span class="c1"># set parameters according to sliders:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;samplingrate&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;FUN&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">}</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;filterwindows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">windowsize</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="n">modelpredictions</span> <span class="o">=</span> <span class="n">my_train_illusion_model</span><span class="p">(</span><span class="n">sensorydata</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">judgments</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;selfmotion&#39;</span><span class="p">]</span>
    <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">modelpredictions</span><span class="p">[</span><span class="s1">&#39;worldmotion&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># plot the predictions:</span>
    <span class="n">my_plot_predictions_data</span><span class="p">(</span><span class="n">judgments</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

    <span class="c1"># calculate R2</span>
    <span class="n">veljudgmnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">judgments</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">judgments</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]))</span>
    <span class="n">velpredict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">predictions</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">predictions</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]))</span>
    <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span>\
      <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">veljudgmnt</span><span class="p">,</span> <span class="n">velpredict</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;predictions -&gt; judgments R2: </span><span class="si">{</span><span class="n">r_value</span> <span class="o">**</span> <span class="mi">2</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">_</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interact</span><span class="p">(</span><span class="n">refresh</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">.</span><span class="mi">01</span><span class="p">),</span> <span class="n">windowsize</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>While the model still predicts velocity judgments better than the conditions (i.e. the model predicts illusions in somewhat similar cases), the <span class="math notranslate nohighlight">\(R^2\)</span> values are a little worse than those of the simpler model. What’s really going on is that the same set of points that were model prediction errors in the previous model are also errors here. All we have done is reduce the spread.</p>
<p><strong>Interpret the model’s meaning</strong></p>
<p>Here’s what you should have learned from model the train illusion:</p>
<ol class="simple">
<li><p>A noisy, vestibular, acceleration signal can give rise to illusory motion.</p></li>
<li><p>However, disambiguating the optic flow by adding the vestibular signal simply adds a lot of noise. This is not a plausible thing for the brain to do.</p></li>
<li><p>Our other hypothesis - credit assignment - is more qualitatively correct, but our simulations were not able to match the frequency of the illusion on a trial-by-trial basis.</p></li>
</ol>
<p>We decided that for now we have learned enough, so it’s time to write it up.</p>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="section-10-model-publication">
<h1>Section 10: Model publication!<a class="headerlink" href="#section-10-model-publication" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># @title Video 10: Publication</span>
<span class="n">video</span> <span class="o">=</span> <span class="n">YouTubeVideo</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;zm8x7oegN6Q&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">854</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">480</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Video available at https://youtube.com/watch?v=</span><span class="si">{</span><span class="n">video</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">video</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Goal:</strong> In order for our model to impact the field, it needs to be accepted by our peers, and order for that to happen it matters how the model is published.</p>
<div class="section" id="td-10-1-write-a-summary-of-the-project">
<h2>TD 10.1: Write a summary of the project<a class="headerlink" href="#td-10-1-write-a-summary-of-the-project" title="Permalink to this headline">¶</a></h2>
<p>Here we will write up our model, by answering the following questions:</p>
<ul class="simple">
<li><p><strong>What is the phenomena</strong>?  Here summarize the part of the phenomena which your model addresses.</p></li>
<li><p><strong>What is the key scientific question?</strong>:  Clearly articulate the question which your model tries to answer.</p></li>
<li><p><strong>What was our hypothesis?</strong>:  Explain the key relationships which we relied on to simulate the phenomena.</p></li>
<li><p><strong>How did your model work?</strong> Give an overview of the model, it’s main components, and how the model works.  ‘’Here we … ‘’</p></li>
<li><p><strong>What did we find? Did the model work?</strong> Explain the key outcomes of your model evaluation.</p></li>
<li><p><strong>What can we conclude?</strong> Conclude as much as you can <em>with reference to the hypothesis</em>, within the limits of the model.</p></li>
<li><p><strong>What did you learn? What is left to be learned?</strong> Briefly argue the plausibility of the approach and what you think is <em>essential</em> that may have been left out.</p></li>
</ul>
<div class="section" id="guidance-for-the-future">
<h3>Guidance for the future<a class="headerlink" href="#guidance-for-the-future" title="Permalink to this headline">¶</a></h3>
<p>There are good guidelines for structuring and writing an effective paper (e.g., <a class="reference external" href="https://doi.org/10.1371/journal.pcbi.1005619">Mensh &amp; Kording, 2017</a>), all of which apply to papers about models. There are some extra considerations when publishing a model. In general, you should explain each of the steps in the paper:</p>
<p><strong>Introduction:</strong> Steps 1 &amp; 2 (maybe 3)</p>
<p><strong>Methods:</strong> Steps 3-7, 9</p>
<p><strong>Results:</strong> Steps 8 &amp; 9, going back to 1, 2 &amp; 4</p>
<p>In addition, you should provide a visualization of the model, and upload the code implementing the model and the data it was trained and tested on to a repository (e.g. GitHub and OSF).</p>
<p>The audience for all of this should be experimentalists, as they are the ones who can test predictions made by your your model and collect new data. This way your models can impact future experiments, and that future data can then be modeled (see modeling process schematic below). Remember your audience - it is <em>always</em> hard to clearly convey the main points of your work to others, especially if your audience doesn’t necessarily create computational models themselves.</p>
<p><img alt="how-to-model process from Blohm et al 2019" src="https://raw.githubusercontent.com/NeuromatchAcademy/course-content/master/tutorials/W1D2_ModelingPractice/static/NMA-W1D2-fig06.png" /></p>
</div>
<div class="section" id="suggestion">
<h3>Suggestion<a class="headerlink" href="#suggestion" title="Permalink to this headline">¶</a></h3>
<p>For every modeling project, a very good exercise in this is to <em><strong>first</strong></em> write a short, 100-word abstract of the project plan and expected impact, like the summary you wrote. This forces focussing on the main points: describing the relevance, question, model, answer and what it all means very succinctly. This allows you to decide to do this project or not <strong>before you commit time writing code for no good purpose</strong>. Notice that this is really what we’ve walked you through carefully in this tutorial! :)</p>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h1>
<p>Confatulations! You have finished Day2 of NMA! In this tutorial, we worked through the rest steps of the process of modeling.</p>
<ul class="simple">
<li><p>We identified the key components of the model, and examined how they work together (step 6)</p></li>
<li><p>We implemented the model (step 7), and completed it (step 8)</p></li>
<li><p>We tested and evaluated our model (step 9), and finally</p></li>
<li><p>We learn how to publish our model in order to increase its visibility amongts our peers</p></li>
</ul>
<div class="section" id="post-script">
<h2>Post-script<a class="headerlink" href="#post-script" title="Permalink to this headline">¶</a></h2>
<p>Note that the model we built here was extremely simple and used artificial data on purpose. It allowed us to go through all the steps of building a model, and hopefully you noticed that it is not always a linear process, you will go back to different steps if you hit a roadblock somewhere.</p>
<p>However, if you’re interested in how to actually approach modeling a similar phenomenon in a probabilistic way, we encourage you to read the paper by <a class="reference external" href="https://doi.org/10.1073/pnas.1820373116">Dokka et. al., 2019</a>, where the authors model how judgments of heading direction are influenced by objects that are also moving.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="reading">
<h1>Reading<a class="headerlink" href="#reading" title="Permalink to this headline">¶</a></h1>
<p>Blohm G, Kording KP, Schrater PR (2020). <em>A How-to-Model Guide for Neuroscience</em> eNeuro, 7(1). <a class="reference external" href="https://doi.org/10.1523/ENEURO.0352-19.2019">https://doi.org/10.1523/ENEURO.0352-19.2019</a></p>
<p>Dokka K, Park H, Jansen M, DeAngelis GC, Angelaki DE (2019). <em>Causal inference accounts for heading perception in the presence of object motion.</em> PNAS, 116(18):9060-9065. <a class="reference external" href="https://doi.org/10.1073/pnas.1820373116">https://doi.org/10.1073/pnas.1820373116</a></p>
<p>Drugowitsch J, DeAngelis GC, Klier EM, Angelaki DE, Pouget A (2014). <em>Optimal Multisensory Decision-Making in a Reaction-Time Task.</em> eLife, 3:e03005. <a class="reference external" href="https://doi.org/10.7554/eLife.03005">https://doi.org/10.7554/eLife.03005</a></p>
<p>Hartmann, M, Haller K, Moser I, Hossner E-J, Mast FW  (2014). <em>Direction detection thresholds of passive self-motion in artistic gymnasts.</em> Exp Brain Res, 232:1249–1258. <a class="reference external" href="https://doi.org/10.1007/s00221-014-3841-0">https://doi.org/10.1007/s00221-014-3841-0</a></p>
<p>Mensh B, Kording K (2017). <em>Ten simple rules for structuring papers.</em> PLOS Comput Biol 13(9): e1005619. <a class="reference external" href="https://doi.org/10.1371/journal.pcbi.1005619">https://doi.org/10.1371/journal.pcbi.1005619</a></p>
<p>Seno T, Fukuda H (2012). <em>Stimulus Meanings Alter Illusory Self-Motion (Vection) - Experimental Examination of the Train Illusion.</em> Seeing Perceiving, 25(6):631-45. <a class="reference external" href="https://doi.org/10.1163/18784763-00002394">https://doi.org/10.1163/18784763-00002394</a></p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./W1D2_ModelingPractice"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="W1D2_Tutorial1.html" title="previous page">Tutorial 1: Framing the question</a>
    <a class='right-next' id="next-link" href="../W1D3_ModelFitting/README.html" title="next page">W1D3 - Model Fitting</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Neuromatch<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>